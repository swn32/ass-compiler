(function(t,r){typeof exports==="object"&&typeof module!=="undefined"?r(exports):typeof define==="function"&&define.amd?define(["exports"],r):(t=typeof globalThis!=="undefined"?globalThis:t||self,r(t.assCompiler={}))})(this,function(t){"use strict";function f(t){var r=t.toLowerCase().trim().split(/\s*;\s*/);if(r[0]==="banner"){return{name:r[0],delay:r[1]*1||0,leftToRight:r[2]*1||0,fadeAwayWidth:r[3]*1||0}}if(/^scroll\s/.test(r[0])){return{name:r[0],y1:Math.min(r[1]*1,r[2]*1),y2:Math.max(r[1]*1,r[2]*1),delay:r[3]*1||0,fadeAwayHeight:r[4]*1||0}}if(t!==""){return{name:t}}return null}function h(t){if(!t){return[]}return t.toLowerCase().replace(/([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?)/g," $1 ").replace(/([mnlbspc])/g," $1 ").trim().replace(/\s+/g," ").split(/\s(?=[mnlbspc])/).map(function(t){return t.split(" ").filter(function(t,r){return!(r&&isNaN(t*1))})})}var r=["b","i","u","s","fsp","k","K","kf","ko","kt","fe","q","p","pbo","a","an","fscx","fscy","fax","fay","frx","fry","frz","fr","be","blur","bord","xbord","ybord","shad","xshad","yshad"];var x=r.map(function(t){return{name:t,regex:new RegExp("^"+t+"-?\\d")}});function b(t){var r;var e={};for(var n=0;n<x.length;n++){var a=x[n];var i=a.name;var s=a.regex;if(s.test(t)){e[i]=t.slice(i.length)*1;return e}}if(/^fn/.test(t)){e.fn=t.slice(2)}else if(/^r/.test(t)){e.r=t.slice(1)}else if(/^fs[\d+-]/.test(t)){e.fs=t.slice(2)}else if(/^\d?c&?H?[0-9a-fA-F]+|^\d?c$/.test(t)){var o=t.match(/^(\d?)c&?H?(\w*)/);var f=o[1];var l=o[2];e["c"+(f||1)]=l&&("000000"+l).slice(-6)}else if(/^\da&?H?[0-9a-fA-F]+/.test(t)){var c=t.match(/^(\d)a&?H?([0-9a-f]+)/i);var u=c[1];var v=c[2];e["a"+u]=("00"+v).slice(-2)}else if(/^alpha&?H?[0-9a-fA-F]+/.test(t)){r=t.match(/^alpha&?H?([0-9a-f]+)/i),e.alpha=r[1];e.alpha=("00"+e.alpha).slice(-2)}else if(/^(?:pos|org|move|fad|fade)\([^)]+/.test(t)){var p=t.match(/^(\w+)\((.*?)\)?$/);var y=p[1];var d=p[2];e[y]=d.trim().split(/\s*,\s*/).map(Number)}else if(/^i?clip\([^)]+/.test(t)){var g=t.match(/^i?clip\((.*?)\)?$/)[1].trim().split(/\s*,\s*/);e.clip={inverse:/iclip/.test(t),scale:1,drawing:null,dots:null};if(g.length===1){e.clip.drawing=h(g[0])}if(g.length===2){e.clip.scale=g[0]*1;e.clip.drawing=h(g[1])}if(g.length===4){e.clip.dots=g.map(Number)}}else if(/^t\(/.test(t)){var m=t.match(/^t\((.*?)\)?$/)[1].trim().replace(/\\.*/,function(t){return t.replace(/,/g,"\n")}).split(/\s*,\s*/);if(!m[0]){return e}e.t={t1:0,t2:0,accel:1,tags:m[m.length-1].replace(/\n/g,",").split("\\").slice(1).map(b)};if(m.length===2){e.t.accel=m[0]*1}if(m.length===3){e.t.t1=m[0]*1;e.t.t2=m[1]*1}if(m.length===4){e.t.t1=m[0]*1;e.t.t2=m[1]*1;e.t.accel=m[2]*1}}return e}function s(t){var r=[];var e=0;var n="";var a=t.split("\\").slice(1).concat("").join("\\");for(var i=0;i<a.length;i++){var s=a[i];if(s==="("){e++}if(s===")"){e--}if(e<0){e=0}if(!e&&s==="\\"){if(n){r.push(n)}n=""}else{n+=s}}return r.map(b)}function l(t){var r=t.split(/{([^{}]*?)}/);var e=[];if(r[0].length){e.push({tags:[],text:r[0],drawing:[]})}for(var n=1;n<r.length;n+=2){var a=s(r[n]);var i=a.reduce(function(t,r){return r.p===undefined?t:!!r.p},false);e.push({tags:a,text:i?"":r[n+1],drawing:i?h(r[n+1]):[]})}return{raw:t,combined:e.map(function(t){return t.text}).join(""),parsed:e}}function c(t){var r=t.split(":");return r[0]*3600+r[1]*60+r[2]*1}function S(t,r){var e=t.split(",");if(e.length>r.length){var n=e.slice(r.length-1).join();e=e.slice(0,r.length-1);e.push(n)}var a={};for(var i=0;i<e.length;i++){var s=r[i];var o=e[i].trim();switch(s){case"Layer":case"MarginL":case"MarginR":case"MarginV":a[s]=o*1;break;case"Start":case"End":a[s]=c(o);break;case"Effect":a[s]=f(o);break;case"Text":a[s]=l(o);break;default:a[s]=o}}return a}var o=["Name","Fontname","Fontsize","PrimaryColour","SecondaryColour","OutlineColour","BackColour","Bold","Italic","Underline","StrikeOut","ScaleX","ScaleY","Spacing","Angle","BorderStyle","Outline","Shadow","Alignment","MarginL","MarginR","MarginV","Encoding"];var u=["Layer","Start","End","Style","Name","MarginL","MarginR","MarginV","Effect","Text"];function j(t){var e=o.concat(u);return t.match(/Format\s*:\s*(.*)/i)[1].split(/\s*,\s*/).map(function(r){var t=e.find(function(t){return t.toLowerCase()===r.toLowerCase()});return t||r})}function w(t,r){var n=t.match(/Style\s*:\s*(.*)/i)[1].split(/\s*,\s*/);return Object.assign.apply(Object,[{}].concat(r.map(function(t,r){var e;return e={},e[t]=n[r],e})))}function O(t,r){return{section:t,type:r,body:[]}}function a(t){var r={info:{},styles:{format:[],style:[]},events:{format:[],comment:[],dialogue:[]},sections:[]};var e=t.split(/\r?\n/);var n=-1;r.sections.push(O(undefined,"unknown"));for(var a=0;a<e.length;a++){var i=e[a].trim();if(/^\s*\[Script Info\]/i.test(i)){n=1;r.sections.push(Object.assign({},O("Script Info","info"),{info:r.info}))}else if(/^\s*\[V4\+? Styles\]/i.test(i)){n=2;r.sections.push(O("V4+ Styles","styles"))}else if(/^\s*\[Events\]/i.test(i)){n=3;r.sections.push(O("Events","events"))}else{var s=/^\s*\[(.*)\]/.exec(i);if(s){n=0;r.sections.push(Object.assign({},O(s[1],"info"),{info:{}}))}}var o=r.sections[r.sections.length-1];if(/^;/.test(i)){o.body.push({type:"comment",line:i.slice(1)})}if(n===0||n===1){if(/:/.test(i)){var f=i.match(/(.*?)\s*:\s*(.*)/);var l=f[1];var c=f[2];o.info[l]=c;o.body.push({type:"entry",key:l})}}if(n===2){if(/^Format\s*:/i.test(i)){var u=j(i);r.styles.format=u;o.format=u;o.body.push({type:"format",format:u})}if(/^Style\s*:/i.test(i)){var v=w(i,r.styles.format);r.styles.style.push(v);o.body.push({type:"entry",value:v})}}if(n===3){if(/^Format\s*:/i.test(i)){var p=j(i);r.events.format=p;o.format=p;o.body.push({type:"format",format:p})}if(/^(?:Comment|Dialogue)\s*:/i.test(i)){var y=i.match(/^(\w+?)\s*:\s*(.*)/i);var d=y[1];var g=y[2];var m=S(g,r.events.format);r.events[d.toLowerCase()].push(m);o.body.push({type:"entry",key:d.toLowerCase().replace(/^\w/,function(t){return t.toUpperCase()}),value:m})}}}r.sections=r.sections.filter(function(t){return t.section!=null||t.body.length!==0});return r}function v(r){return Object.keys(r).map(function(t){return t+": "+r[t]}).join("\n")}function p(t){return("00"+t).slice(-2)}function e(t){var r=Number.parseFloat(t.toFixed(2));var e=r.toFixed(2).slice(-2);var n=(r|0)%60;var a=(r/60|0)%60;var i=r/3600|0;return i+":"+p(a)+":"+p(n)+"."+e}function n(t){if(!t){return""}if(t.name==="banner"){return"Banner;"+t.delay+";"+t.leftToRight+";"+t.fadeAwayWidth}if(/^scroll\s/.test(t.name)){return t.name.replace(/^\w/,function(t){return t.toUpperCase()})+";"+t.y1+";"+t.y2+";"+t.delay+";"+t.fadeAwayHeight}return t.name}function y(t){return t.map(function(t){return t.join(" ")}).join(" ")}function d(t){var r=Object.keys(t);var e=r[0];if(!e){return""}var n=t[e];if(["pos","org","move","fad","fade"].some(function(t){return t===e})){return"\\"+e+"("+n+")"}if(/^[ac]\d$/.test(e)){return"\\"+e[1]+e[0]+"&H"+n+"&"}if(e==="alpha"){return"\\alpha&H"+n+"&"}if(e==="clip"){return"\\"+(n.inverse?"i":"")+"clip("+(n.dots||""+(n.scale===1?"":n.scale+",")+y(n.drawing))+")"}if(e==="t"){return"\\t("+[n.t1,n.t2,n.accel,n.tags.map(d).join("")]+")"}return"\\"+e+n}function i(t){return t.parsed.map(function(t){var r=t.tags;var e=t.text;var n=t.drawing;var a=r.map(d).join("");var i=n.length?y(n):e;return""+(a?"{"+a+"}":"")+i}).join("")}function g(r,t){return t.map(function(t){switch(t){case"Start":case"End":return e(r[t]);case"MarginL":case"MarginR":case"MarginV":return r[t]||"0";case"Effect":return n(r[t]);case"Text":return i(r.Text);default:return r[t]}}).join()}function m(t){var r=t.sections;return r.map(function(t){return(t.section!=null?["["+t.section+"]"]:[]).concat(t.body.map(function(r){return[r.type==="comment"?";"+r.line:r.type==="format"?"Format: "+r.format.join(", "):r.type==="entry"?t.type==="info"?r.key+": "+t.info[r.key]:t.type==="styles"?"Style: "+t.format.map(function(t){return r.value[t]}).join():t.type==="events"?r.key+": "+g(r.value,t.format):undefined:undefined]}),[""]).join("\n")}).join("\n")}function M(t){var r={type:null,prev:null,next:null,points:[]};if(/[mnlbs]/.test(t[0])){r.type=t[0].toUpperCase().replace("N","L").replace("B","C")}for(var e=t.length-!(t.length&1),n=1;n<e;n+=2){r.points.push({x:t[n]*1,y:t[n+1]*1})}return r}function C(t){if(!t.points.length||!t.type){return false}if(/C|S/.test(t.type)&&t.points.length<3){return false}return true}function R(t){var r;var n=Infinity;var a=Infinity;var i=-Infinity;var s=-Infinity;(r=[]).concat.apply(r,t.map(function(t){var r=t.points;return r})).forEach(function(t){var r=t.x;var e=t.y;n=Math.min(n,r);a=Math.min(a,e);i=Math.max(i,r);s=Math.max(s,e)});return{minX:n,minY:a,width:i-n,height:s-a}}function I(t,r,e){var n=[];var a=[0,2/3,1/3,0];var i=[0,1/3,2/3,0];var s=[0,1/6,2/3,1/6];var o=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]+t[3]*r[3]};var f=[t[t.length-1].x,t[0].x,t[1].x,t[2].x];var l=[t[t.length-1].y,t[0].y,t[1].y,t[2].y];n.push({type:r==="M"?"M":"L",points:[{x:o(s,f),y:o(s,l)}]});for(var c=3;c<t.length;c++){f=[t[c-3].x,t[c-2].x,t[c-1].x,t[c].x];l=[t[c-3].y,t[c-2].y,t[c-1].y,t[c].y];n.push({type:"C",points:[{x:o(a,f),y:o(a,l)},{x:o(i,f),y:o(i,l)},{x:o(s,f),y:o(s,l)}]})}if(e==="L"||e==="C"){var u=t[t.length-1];n.push({type:"L",points:[{x:u.x,y:u.y}]})}return n}function V(t){return t.map(function(t){var r=t.type;var e=t.points;return r+e.map(function(t){var r=t.x;var e=t.y;return r+","+e}).join(",")}).join("")}function $(t){var r;var e=[];var n=0;while(n<t.length){var a=t[n];var i=M(a);if(C(i)){if(i.type==="S"){var s=(e[n-1]||{points:[{x:0,y:0}]}).points.slice(-1)[0];var o=s.x;var f=s.y;i.points.unshift({x:o,y:f})}if(n){i.prev=e[n-1].type;e[n-1].next=i.type}e.push(i);n++}else{if(n&&e[n-1].type==="S"){var l={p:i.points,c:e[n-1].points.slice(0,3)};e[n-1].points=e[n-1].points.concat((l[a[0]]||[]).map(function(t){var r=t.x;var e=t.y;return{x:r,y:e}}))}t.splice(n,1)}}var c=(r=[]).concat.apply(r,e.map(function(t){var r=t.type;var e=t.points;var n=t.prev;var a=t.next;return r==="S"?I(e,n,a):{type:r,points:e}}));return Object.assign({instructions:c,d:V(c)},R(e))}var T=["fs","fsp","clip","c1","c2","c3","c4","a1","a2","a3","a4","alpha","fscx","fscy","fax","fay","frx","fry","frz","fr","be","blur","bord","xbord","ybord","shad","xshad","yshad"];function B(t,r,e){var n,a,i;if(e===void 0)e={};var s=t[r];if(s===undefined){return null}if(r==="pos"||r==="org"){return s.length===2?(n={},n[r]={x:s[0],y:s[1]},n):null}if(r==="move"){var o=s[0];var f=s[1];var l=s[2];var c=s[3];var u=s[4];if(u===void 0)u=0;var v=s[5];if(v===void 0)v=0;return s.length===4||s.length===6?{move:{x1:o,y1:f,x2:l,y2:c,t1:u,t2:v}}:null}if(r==="fad"||r==="fade"){if(s.length===2){var p=s[0];var y=s[1];return{fade:{type:"fad",t1:p,t2:y}}}if(s.length===7){var d=s[0];var g=s[1];var m=s[2];var h=s[3];var x=s[4];var b=s[5];var S=s[6];return{fade:{type:"fade",a1:d,a2:g,a3:m,t1:h,t2:x,t3:b,t4:S}}}return null}if(r==="clip"){var j=s.inverse;var w=s.scale;var O=s.drawing;var M=s.dots;if(O){return{clip:{inverse:j,scale:w,drawing:$(O),dots:M}}}if(M){var C=M[0];var k=M[1];var F=M[2];var L=M[3];return{clip:{inverse:j,scale:w,drawing:O,dots:{x1:C,y1:k,x2:F,y2:L}}}}return null}if(/^[xy]?(bord|shad)$/.test(r)){s=Math.max(s,0)}if(r==="bord"){return{xbord:s,ybord:s}}if(r==="shad"){return{xshad:s,yshad:s}}if(/^c\d$/.test(r)){return a={},a[r]=s||e[r],a}if(r==="alpha"){return{a1:s,a2:s,a3:s,a4:s}}if(r==="fr"){return{frz:s}}if(r==="fs"){return{fs:/^\+|-/.test(s)?(s*1>-10?1+s/10:1)*e.fs:s*1}}if(r==="K"){return{kf:s}}if(r==="t"){var H=s.t1;var N=s.accel;var E=s.tags;var A=s.t2||(e.end-e.start)*1e3;var R={};E.forEach(function(t){var r=Object.keys(t)[0];if(~T.indexOf(r)&&!(r==="clip"&&!t[r].dots)){Object.assign(R,B(t,r,e))}});return{t:{t1:H,t2:A,accel:N,tag:R}}}return i={},i[r]=s,i}var P=[null,1,2,3,null,7,8,9,null,4,5,6];var z=["r","a","an","pos","org","move","fade","fad","clip"];function D(t){return JSON.parse(JSON.stringify(Object.assign({},t,{k:undefined,kf:undefined,ko:undefined,kt:undefined})))}function U(t){var r=t.styles;var e=t.style;var n=t.parsed;var a=t.start;var i=t.end;var s;var o={q:r[e].tag.q};var f;var l;var c;var u;var v;var p=[];var y={style:e,fragments:[]};var d={};for(var g=0;g<n.length;g++){var m=n[g];var h=m.tags;var x=m.text;var b=m.drawing;var S=void 0;for(var j=0;j<h.length;j++){var w=h[j];S=w.r===undefined?S:w.r}var O={tag:S===undefined?D(d):{},text:x,drawing:b.length?$(b):null};for(var M=0;M<h.length;M++){var C=h[M];s=s||P[C.a||0]||C.an;o=B(C,"q")||o;f=f||B(C,"pos");l=l||B(C,"org");c=c||B(C,"move");u=u||B(C,"fade")||B(C,"fad");v=B(C,"clip")||v;var k=Object.keys(C)[0];if(k&&!~z.indexOf(k)){var F=r[e].tag;var L=F.c1;var H=F.c2;var N=F.c3;var E=F.c4;var A=d.fs||F.fs;var R=B(C,k,{start:a,end:i,c1:L,c2:H,c3:N,c4:E,fs:A});if(k==="t"){O.tag.t=O.tag.t||[];O.tag.t.push(R.t)}else{Object.assign(O.tag,R)}}}d=O.tag;if(S!==undefined){p.push(y);y={style:r[S]?S:e,fragments:[]}}if(O.text||O.drawing){var I=y.fragments[y.fragments.length-1]||{};if(I.text&&O.text&&!Object.keys(O.tag).length){I.text+=O.text}else{y.fragments.push(O)}}}p.push(y);return Object.assign({alignment:s,slices:p},o,f,l,c,u,v)}function W(t){var r=t.styles;var e=t.dialogues;var n=Infinity;var a=[];for(var i=0;i<e.length;i++){var s=e[i];if(s.Start>=s.End){continue}if(!r[s.Style]){s.Style="Default"}var o=r[s.Style].style;var f=U({styles:r,style:s.Style,parsed:s.Text.parsed,start:s.Start,end:s.End});var l=f.alignment||o.Alignment;n=Math.min(n,s.Layer);a.push(Object.assign({layer:s.Layer,start:s.Start,end:s.End,style:s.Style,name:s.Name,margin:{left:s.MarginL||o.MarginL,right:s.MarginR||o.MarginR,vertical:s.MarginV||o.MarginV},effect:s.Effect},f,{alignment:l}))}for(var c=0;c<a.length;c++){a[c].layer-=n}return a.sort(function(t,r){return t.start-r.start||t.end-r.end})}var X={Name:"Default",Fontname:"Arial",Fontsize:"20",PrimaryColour:"&H00FFFFFF&",SecondaryColour:"&H000000FF&",OutlineColour:"&H00000000&",BackColour:"&H00000000&",Bold:"0",Italic:"0",Underline:"0",StrikeOut:"0",ScaleX:"100",ScaleY:"100",Spacing:"0",Angle:"0",BorderStyle:"1",Outline:"2",Shadow:"2",Alignment:"2",MarginL:"10",MarginR:"10",MarginV:"10",Encoding:"1"};function k(t){if(/^(&|H|&H)[0-9a-f]{6,}/i.test(t)){var r=t.match(/&?H?([0-9a-f]{2})?([0-9a-f]{6})/i);var e=r[1];var n=r[2];return[e||"00",n]}var a=parseInt(t,10);if(!isNaN(a)){var i=-2147483648;var s=2147483647;if(a<i){return["00","000000"]}var o=i<=a&&a<=s?("00000000"+(a<0?a+4294967296:a).toString(16)).slice(-8):String(a).slice(0,8);return[o.slice(0,2),o.slice(2)]}return["00","000000"]}function Y(t){var d=t.info;var r=t.style;var e=t.defaultStyle;var g={};var m=[Object.assign({},e,{Name:"Default"})].concat(r);var n=function(t){var r=Object.assign({},X,m[t]);if(/^(\*+)Default$/.test(r.Name)){r.Name="Default"}Object.keys(r).forEach(function(t){if(t!=="Name"&&t!=="Fontname"&&!/Colour/.test(t)){r[t]*=1}});var e=k(r.PrimaryColour);var n=e[0];var a=e[1];var i=k(r.SecondaryColour);var s=i[0];var o=i[1];var f=k(r.OutlineColour);var l=f[0];var c=f[1];var u=k(r.BackColour);var v=u[0];var p=u[1];var y={fn:r.Fontname,fs:r.Fontsize,c1:a,a1:n,c2:o,a2:s,c3:c,a3:l,c4:p,a4:v,b:Math.abs(r.Bold),i:Math.abs(r.Italic),u:Math.abs(r.Underline),s:Math.abs(r.StrikeOut),fscx:r.ScaleX,fscy:r.ScaleY,fsp:r.Spacing,frz:r.Angle,xbord:r.Outline,ybord:r.Outline,xshad:r.Shadow,yshad:r.Shadow,fe:r.Encoding,q:/^[0-3]$/.test(d.WrapStyle)?d.WrapStyle*1:2};g[r.Name]={style:r,tag:y}};for(var a=0;a<m.length;a++)n(a);return g}function q(t,r){if(r===void 0)r={};var e=a(t);var n=Y({info:e.info,style:e.styles.style,defaultStyle:r.defaultStyle||{}});return{info:e.info,width:e.info.PlayResX*1||null,height:e.info.PlayResY*1||null,wrapStyle:/^[0-3]$/.test(e.info.WrapStyle)?e.info.WrapStyle*1:2,collisions:e.info.Collisions||"Normal",styles:n,dialogues:W({styles:n,dialogues:e.events.dialogue})}}function J(t){var r=t.style;var e=t.tag;var n=Object.assign({},r,{PrimaryColour:"&H"+e.a1+e.c1,SecondaryColour:"&H"+e.a2+e.c2,OutlineColour:"&H"+e.a3+e.c3,BackColour:"&H"+e.a4+e.c4});return"Style: "+o.map(function(t){return n[t]}).join()}var K={M:"m",L:"l",C:"b"};function F(t){var r=t.instructions;return r.map(function(t){var r;var e=t.type;var n=t.points;return(r=[K[e]]).concat.apply(r,n.map(function(t){var r=t.x;var e=t.y;return[r,e]})).join(" ")}).join(" ")}var L=function(e){return function(r){return function(t){return""+r+e+"&H"+t+"&"}}};var H=L("c");var N=L("a");var G={c1:H(1),c2:H(2),c3:H(3),c4:H(4),a1:N(1),a2:N(2),a3:N(3),a4:N(4),pos:function(t){return"pos("+[t.x,t.y]+")"},org:function(t){return"org("+[t.x,t.y]+")"},move:function(t){return"move("+[t.x1,t.y1,t.x2,t.y2,t.t1,t.t2]+")"},fade:function(t){return t.type==="fad"?"fad("+[t.t1,t.t2]+")":"fade("+[t.a1,t.a2,t.a3,t.t1,t.t2,t.t3,t.t4]+")"},clip:function(t){return(t.inverse?"i":"")+"clip("+(t.dots?""+[t.dots.x1,t.dots.y1,t.dots.x2,t.dots.y2]:""+(t.scale===1?"":t.scale+",")+F(t.drawing))+")"},t:function(t){return t.map(function(t){return"t("+[t.t1,t.t2,t.accel,E(t.tag)]+")"}).join("\\")}};function E(e){return Object.keys(e).map(function(r){var t=G[r]||function(t){return""+r+t};return"\\"+t(e[r])}).join("")}function Q(t){return t.fragments.map(function(t){var r=t.tag;var e=t.text;var n=t.drawing;var a=E(r);return""+(a?"{"+a+"}":"")+(n?F(n):e)}).join("")}function Z(a,i){return a.slices.filter(function(t){return t.fragments.length}).map(function(t,r){var e=JSON.parse(JSON.stringify(t));var n={};if(r){n.r=t.style===a.style?"":t.style}else{if(i.Alignment!==a.alignment){n.an=a.alignment}["pos","org","move","fade","clip"].forEach(function(t){if(a[t]){n[t]=a[t]}})}e.fragments[0].tag=Object.assign(n,e.fragments[0].tag);return e}).map(Q).join("")}function A(t,r){return t===r?"0000":t}function _(t,r){return"Dialogue: "+[t.layer,e(t.start),e(t.end),t.style,t.name,A(t.margin.left,r.MarginL),A(t.margin.right,r.MarginR),A(t.margin.vertical,r.MarginV),n(t.effect),Z(t,r)].join()}function tt(t){var r=t.info;var e=t.width;var n=t.height;var a=t.collisions;var i=t.styles;var s=t.dialogues;return["[Script Info]",v(Object.assign({},r,{PlayResX:e,PlayResY:n,Collisions:a})),"","[V4+ Styles]","Format: "+o.join(", ")].concat(Object.keys(i).map(function(t){return J(i[t])}),[""],["[Events]"],["Format: "+u.join(", ")],s.sort(function(t,r){return t.start-r.start||t.end-r.end}).map(function(t){return _(t,i[t.style].style)}),[""]).join("\n")}t.compile=q;t.decompile=tt;t.parse=a;t.stringify=m});