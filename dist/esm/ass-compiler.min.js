function parseEffect(e){var t=e.toLowerCase().trim().split(/\s*;\s*/);if(t[0]==="banner"){return{name:t[0],delay:t[1]*1||0,leftToRight:t[2]*1||0,fadeAwayWidth:t[3]*1||0}}if(/^scroll\s/.test(t[0])){return{name:t[0],y1:Math.min(t[1]*1,t[2]*1),y2:Math.max(t[1]*1,t[2]*1),delay:t[3]*1||0,fadeAwayHeight:t[4]*1||0}}if(e!==""){return{name:e}}return null}function parseDrawing(e){if(!e){return[]}return e.toLowerCase().replace(/([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?)/g," $1 ").replace(/([mnlbspc])/g," $1 ").trim().replace(/\s+/g," ").split(/\s(?=[mnlbspc])/).map(function(e){return e.split(" ").filter(function(e,t){return!(t&&isNaN(e*1))})})}var numTags=["b","i","u","s","fsp","k","K","kf","ko","kt","fe","q","p","pbo","a","an","fscx","fscy","fax","fay","frx","fry","frz","fr","be","blur","bord","xbord","ybord","shad","xshad","yshad"];var numRegexs=numTags.map(function(e){return{name:e,regex:new RegExp("^"+e+"-?\\d")}});function parseTag(e){var t;var r={};for(var a=0;a<numRegexs.length;a++){var n=numRegexs[a];var i=n.name;var s=n.regex;if(s.test(e)){r[i]=e.slice(i.length)*1;return r}}if(/^fn/.test(e)){r.fn=e.slice(2)}else if(/^r/.test(e)){r.r=e.slice(1)}else if(/^fs[\d+-]/.test(e)){r.fs=e.slice(2)}else if(/^\d?c&?H?[0-9a-fA-F]+|^\d?c$/.test(e)){var o=e.match(/^(\d?)c&?H?(\w*)/);var l=o[1];var c=o[2];r["c"+(l||1)]=c&&("000000"+c).slice(-6)}else if(/^\da&?H?[0-9a-fA-F]+/.test(e)){var f=e.match(/^(\d)a&?H?([0-9a-f]+)/i);var u=f[1];var p=f[2];r["a"+u]=("00"+p).slice(-2)}else if(/^alpha&?H?[0-9a-fA-F]+/.test(e)){t=e.match(/^alpha&?H?([0-9a-f]+)/i),r.alpha=t[1];r.alpha=("00"+r.alpha).slice(-2)}else if(/^(?:pos|org|move|fad|fade)\([^)]+/.test(e)){var v=e.match(/^(\w+)\((.*?)\)?$/);var g=v[1];var y=v[2];r[g]=y.trim().split(/\s*,\s*/).map(Number)}else if(/^i?clip\([^)]+/.test(e)){var m=e.match(/^i?clip\((.*?)\)?$/)[1].trim().split(/\s*,\s*/);r.clip={inverse:/iclip/.test(e),scale:1,drawing:null,dots:null};if(m.length===1){r.clip.drawing=parseDrawing(m[0])}if(m.length===2){r.clip.scale=m[0]*1;r.clip.drawing=parseDrawing(m[1])}if(m.length===4){r.clip.dots=m.map(Number)}}else if(/^t\(/.test(e)){var d=e.match(/^t\((.*?)\)?$/)[1].trim().replace(/\\.*/,function(e){return e.replace(/,/g,"\n")}).split(/\s*,\s*/);if(!d[0]){return r}r.t={t1:0,t2:0,accel:1,tags:d[d.length-1].replace(/\n/g,",").split("\\").slice(1).map(parseTag)};if(d.length===2){r.t.accel=d[0]*1}if(d.length===3){r.t.t1=d[0]*1;r.t.t2=d[1]*1}if(d.length===4){r.t.t1=d[0]*1;r.t.t2=d[1]*1;r.t.accel=d[2]*1}}return r}function parseTags(e){var t=[];var r=0;var a="";var n=e.split("\\").slice(1).concat("").join("\\");for(var i=0;i<n.length;i++){var s=n[i];if(s==="("){r++}if(s===")"){r--}if(r<0){r=0}if(!r&&s==="\\"){if(a){t.push(a)}a=""}else{a+=s}}return t.map(parseTag)}function parseText(e){var t=e.split(/{([^{}]*?)}/);var r=[];if(t[0].length){r.push({tags:[],text:t[0],drawing:[]})}for(var a=1;a<t.length;a+=2){var n=parseTags(t[a]);var i=n.reduce(function(e,t){return t.p===undefined?e:!!t.p},false);r.push({tags:n,text:i?"":t[a+1],drawing:i?parseDrawing(t[a+1]):[]})}return{raw:e,combined:r.map(function(e){return e.text}).join(""),parsed:r}}function parseTime(e){var t=e.split(":");return t[0]*3600+t[1]*60+t[2]*1}function parseDialogue(e,t){var r=e.split(",");if(r.length>t.length){var a=r.slice(t.length-1).join();r=r.slice(0,t.length-1);r.push(a)}var n={};for(var i=0;i<r.length;i++){var s=t[i];var o=r[i].trim();switch(s){case"Layer":case"MarginL":case"MarginR":case"MarginV":n[s]=o*1;break;case"Start":case"End":n[s]=parseTime(o);break;case"Effect":n[s]=parseEffect(o);break;case"Text":n[s]=parseText(o);break;default:n[s]=o}}return n}var stylesFormat=["Name","Fontname","Fontsize","PrimaryColour","SecondaryColour","OutlineColour","BackColour","Bold","Italic","Underline","StrikeOut","ScaleX","ScaleY","Spacing","Angle","BorderStyle","Outline","Shadow","Alignment","MarginL","MarginR","MarginV","Encoding"];var eventsFormat=["Layer","Start","End","Style","Name","MarginL","MarginR","MarginV","Effect","Text"];function parseFormat(e){var r=stylesFormat.concat(eventsFormat);return e.match(/Format\s*:\s*(.*)/i)[1].split(/\s*,\s*/).map(function(t){var e=r.find(function(e){return e.toLowerCase()===t.toLowerCase()});return e||t})}function parseStyle(e,t){var a=e.match(/Style\s*:\s*(.*)/i)[1].split(/\s*,\s*/);return Object.assign.apply(Object,[{}].concat(t.map(function(e,t){var r;return r={},r[e]=a[t],r})))}function createNewSection(e,t){return{section:e,type:t,body:[]}}function parse(e){var t={info:{},styles:{format:[],style:[]},events:{format:[],comment:[],dialogue:[]},sections:[]};var r=e.split(/\r?\n/);var a=-1;t.sections.push(createNewSection(undefined,"unknown"));for(var n=0;n<r.length;n++){var i=r[n].trim();if(/^\s*\[Script Info\]/i.test(i)){a=1;t.sections.push(Object.assign({},createNewSection("Script Info","info"),{info:t.info}))}else if(/^\s*\[V4\+? Styles\]/i.test(i)){a=2;t.sections.push(createNewSection("V4+ Styles","styles"))}else if(/^\s*\[Events\]/i.test(i)){a=3;t.sections.push(createNewSection("Events","events"))}else{var s=/^\s*\[(.*)\]/.exec(i);if(s){a=0;t.sections.push(Object.assign({},createNewSection(s[1],"info"),{info:{}}))}}var o=t.sections[t.sections.length-1];if(/^;/.test(i)){o.body.push({type:"comment",line:i.slice(1)})}if(a===0||a===1){if(/:/.test(i)){var l=i.match(/(.*?)\s*:\s*(.*)/);var c=l[1];var f=l[2];o.info[c]=f;o.body.push({type:"entry",key:c})}}if(a===2){if(/^Format\s*:/i.test(i)){var u=parseFormat(i);t.styles.format=u;o.format=u;o.body.push({type:"format",format:u})}if(/^Style\s*:/i.test(i)){var p=parseStyle(i,t.styles.format);t.styles.style.push(p);o.body.push({type:"entry",value:p})}}if(a===3){if(/^Format\s*:/i.test(i)){var v=parseFormat(i);t.events.format=v;o.format=v;o.body.push({type:"format",format:v})}if(/^(?:Comment|Dialogue)\s*:/i.test(i)){var g=i.match(/^(\w+?)\s*:\s*(.*)/i);var y=g[1];var m=g[2];var d=parseDialogue(m,t.events.format);t.events[y.toLowerCase()].push(d);o.body.push({type:"entry",key:y.toLowerCase().replace(/^\w/,function(e){return e.toUpperCase()}),value:d})}}}t.sections=t.sections.filter(function(e){return e.section!=null||e.body.length!==0});return t}function stringifyInfo(t){return Object.keys(t).map(function(e){return e+": "+t[e]}).join("\n")}function pad00(e){return("00"+e).slice(-2)}function stringifyTime(e){var t=Number.parseFloat(e.toFixed(2));var r=t.toFixed(2).slice(-2);var a=(t|0)%60;var n=(t/60|0)%60;var i=t/3600|0;return i+":"+pad00(n)+":"+pad00(a)+"."+r}function stringifyEffect(e){if(!e){return""}if(e.name==="banner"){return"Banner;"+e.delay+";"+e.leftToRight+";"+e.fadeAwayWidth}if(/^scroll\s/.test(e.name)){return e.name.replace(/^\w/,function(e){return e.toUpperCase()})+";"+e.y1+";"+e.y2+";"+e.delay+";"+e.fadeAwayHeight}return e.name}function stringifyDrawing(e){return e.map(function(e){return e.join(" ")}).join(" ")}function stringifyTag(e){var t=Object.keys(e);var r=t[0];if(!r){return""}var a=e[r];if(["pos","org","move","fad","fade"].some(function(e){return e===r})){return"\\"+r+"("+a+")"}if(/^[ac]\d$/.test(r)){return"\\"+r[1]+r[0]+"&H"+a+"&"}if(r==="alpha"){return"\\alpha&H"+a+"&"}if(r==="clip"){return"\\"+(a.inverse?"i":"")+"clip("+(a.dots||""+(a.scale===1?"":a.scale+",")+stringifyDrawing(a.drawing))+")"}if(r==="t"){return"\\t("+[a.t1,a.t2,a.accel,a.tags.map(stringifyTag).join("")]+")"}return"\\"+r+a}function stringifyText(e){return e.parsed.map(function(e){var t=e.tags;var r=e.text;var a=e.drawing;var n=t.map(stringifyTag).join("");var i=a.length?stringifyDrawing(a):r;return""+(n?"{"+n+"}":"")+i}).join("")}function stringifyEvent(t,e){return e.map(function(e){switch(e){case"Start":case"End":return stringifyTime(t[e]);case"MarginL":case"MarginR":case"MarginV":return t[e]||"0";case"Effect":return stringifyEffect(t[e]);case"Text":return stringifyText(t.Text);default:return t[e]}}).join()}function stringify(e){var t=e.sections;return t.map(function(e){return(e.section!=null?["["+e.section+"]"]:[]).concat(e.body.map(function(t){return[t.type==="comment"?";"+t.line:t.type==="format"?"Format: "+t.format.join(", "):t.type==="entry"?e.type==="info"?t.key+": "+e.info[t.key]:e.type==="styles"?"Style: "+e.format.map(function(e){return t.value[e]}).join():e.type==="events"?t.key+": "+stringifyEvent(t.value,e.format):undefined:undefined]}),[""]).join("\n")}).join("\n")}function createCommand(e){var t={type:null,prev:null,next:null,points:[]};if(/[mnlbs]/.test(e[0])){t.type=e[0].toUpperCase().replace("N","L").replace("B","C")}for(var r=e.length-!(e.length&1),a=1;a<r;a+=2){t.points.push({x:e[a]*1,y:e[a+1]*1})}return t}function isValid(e){if(!e.points.length||!e.type){return false}if(/C|S/.test(e.type)&&e.points.length<3){return false}return true}function getViewBox(e){var t;var a=Infinity;var n=Infinity;var i=-Infinity;var s=-Infinity;(t=[]).concat.apply(t,e.map(function(e){var t=e.points;return t})).forEach(function(e){var t=e.x;var r=e.y;a=Math.min(a,t);n=Math.min(n,r);i=Math.max(i,t);s=Math.max(s,r)});return{minX:a,minY:n,width:i-a,height:s-n}}function s2b(e,t,r){var a=[];var n=[0,2/3,1/3,0];var i=[0,1/3,2/3,0];var s=[0,1/6,2/3,1/6];var o=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]};var l=[e[e.length-1].x,e[0].x,e[1].x,e[2].x];var c=[e[e.length-1].y,e[0].y,e[1].y,e[2].y];a.push({type:t==="M"?"M":"L",points:[{x:o(s,l),y:o(s,c)}]});for(var f=3;f<e.length;f++){l=[e[f-3].x,e[f-2].x,e[f-1].x,e[f].x];c=[e[f-3].y,e[f-2].y,e[f-1].y,e[f].y];a.push({type:"C",points:[{x:o(n,l),y:o(n,c)},{x:o(i,l),y:o(i,c)},{x:o(s,l),y:o(s,c)}]})}if(r==="L"||r==="C"){var u=e[e.length-1];a.push({type:"L",points:[{x:u.x,y:u.y}]})}return a}function toSVGPath(e){return e.map(function(e){var t=e.type;var r=e.points;return t+r.map(function(e){var t=e.x;var r=e.y;return t+","+r}).join(",")}).join("")}function compileDrawing(e){var t;var r=[];var a=0;while(a<e.length){var n=e[a];var i=createCommand(n);if(isValid(i)){if(i.type==="S"){var s=(r[a-1]||{points:[{x:0,y:0}]}).points.slice(-1)[0];var o=s.x;var l=s.y;i.points.unshift({x:o,y:l})}if(a){i.prev=r[a-1].type;r[a-1].next=i.type}r.push(i);a++}else{if(a&&r[a-1].type==="S"){var c={p:i.points,c:r[a-1].points.slice(0,3)};r[a-1].points=r[a-1].points.concat((c[n[0]]||[]).map(function(e){var t=e.x;var r=e.y;return{x:t,y:r}}))}e.splice(a,1)}}var f=(t=[]).concat.apply(t,r.map(function(e){var t=e.type;var r=e.points;var a=e.prev;var n=e.next;return t==="S"?s2b(r,a,n):{type:t,points:r}}));return Object.assign({instructions:f,d:toSVGPath(f)},getViewBox(r))}var tTags=["fs","fsp","clip","c1","c2","c3","c4","a1","a2","a3","a4","alpha","fscx","fscy","fax","fay","frx","fry","frz","fr","be","blur","bord","xbord","ybord","shad","xshad","yshad"];function compileTag(e,t,r){var a,n,i;if(r===void 0)r={};var s=e[t];if(s===undefined){return null}if(t==="pos"||t==="org"){return s.length===2?(a={},a[t]={x:s[0],y:s[1]},a):null}if(t==="move"){var o=s[0];var l=s[1];var c=s[2];var f=s[3];var u=s[4];if(u===void 0)u=0;var p=s[5];if(p===void 0)p=0;return s.length===4||s.length===6?{move:{x1:o,y1:l,x2:c,y2:f,t1:u,t2:p}}:null}if(t==="fad"||t==="fade"){if(s.length===2){var v=s[0];var g=s[1];return{fade:{type:"fad",t1:v,t2:g}}}if(s.length===7){var y=s[0];var m=s[1];var d=s[2];var h=s[3];var x=s[4];var S=s[5];var b=s[6];return{fade:{type:"fade",a1:y,a2:m,a3:d,t1:h,t2:x,t3:S,t4:b}}}return null}if(t==="clip"){var w=s.inverse;var T=s.scale;var j=s.drawing;var M=s.dots;if(j){return{clip:{inverse:w,scale:T,drawing:compileDrawing(j),dots:M}}}if(M){var C=M[0];var O=M[1];var F=M[2];var k=M[3];return{clip:{inverse:w,scale:T,drawing:j,dots:{x1:C,y1:O,x2:F,y2:k}}}}return null}if(/^[xy]?(bord|shad)$/.test(t)){s=Math.max(s,0)}if(t==="bord"){return{xbord:s,ybord:s}}if(t==="shad"){return{xshad:s,yshad:s}}if(/^c\d$/.test(t)){return n={},n[t]=s||r[t],n}if(t==="alpha"){return{a1:s,a2:s,a3:s,a4:s}}if(t==="fr"){return{frz:s}}if(t==="fs"){return{fs:/^\+|-/.test(s)?(s*1>-10?1+s/10:1)*r.fs:s*1}}if(t==="K"){return{kf:s}}if(t==="t"){var E=s.t1;var D=s.accel;var N=s.tags;var L=s.t2||(r.end-r.start)*1e3;var H={};N.forEach(function(e){var t=Object.keys(e)[0];if(~tTags.indexOf(t)&&!(t==="clip"&&!e[t].dots)){Object.assign(H,compileTag(e,t,r))}});return{t:{t1:E,t2:L,accel:D,tag:H}}}return i={},i[t]=s,i}var a2an=[null,1,2,3,null,7,8,9,null,4,5,6];var globalTags=["r","a","an","pos","org","move","fade","fad","clip"];function inheritTag(e){return JSON.parse(JSON.stringify(Object.assign({},e,{k:undefined,kf:undefined,ko:undefined,kt:undefined})))}function compileText(e){var t=e.styles;var r=e.style;var a=e.parsed;var n=e.start;var i=e.end;var s;var o={q:t[r].tag.q};var l;var c;var f;var u;var p;var v=[];var g={style:r,fragments:[]};var y={};for(var m=0;m<a.length;m++){var d=a[m];var h=d.tags;var x=d.text;var S=d.drawing;var b=void 0;for(var w=0;w<h.length;w++){var T=h[w];b=T.r===undefined?b:T.r}var j={tag:b===undefined?inheritTag(y):{},text:x,drawing:S.length?compileDrawing(S):null};for(var M=0;M<h.length;M++){var C=h[M];s=s||a2an[C.a||0]||C.an;o=compileTag(C,"q")||o;l=l||compileTag(C,"pos");c=c||compileTag(C,"org");f=f||compileTag(C,"move");u=u||compileTag(C,"fade")||compileTag(C,"fad");p=compileTag(C,"clip")||p;var O=Object.keys(C)[0];if(O&&!~globalTags.indexOf(O)){var F=t[r].tag;var k=F.c1;var E=F.c2;var D=F.c3;var N=F.c4;var L=y.fs||F.fs;var H=compileTag(C,O,{start:n,end:i,c1:k,c2:E,c3:D,c4:N,fs:L});if(O==="t"){j.tag.t=j.tag.t||[];j.tag.t.push(H.t)}else{Object.assign(j.tag,H)}}}y=j.tag;if(b!==undefined){v.push(g);g={style:t[b]?b:r,fragments:[]}}if(j.text||j.drawing){var R=g.fragments[g.fragments.length-1]||{};if(R.text&&j.text&&!Object.keys(j.tag).length){R.text+=j.text}else{g.fragments.push(j)}}}v.push(g);return Object.assign({alignment:s,slices:v},o,l,c,f,u,p)}function compileDialogues(e){var t=e.styles;var r=e.dialogues;var a=Infinity;var n=[];for(var i=0;i<r.length;i++){var s=r[i];if(s.Start>=s.End){continue}if(!t[s.Style]){s.Style="Default"}var o=t[s.Style].style;var l=compileText({styles:t,style:s.Style,parsed:s.Text.parsed,start:s.Start,end:s.End});var c=l.alignment||o.Alignment;a=Math.min(a,s.Layer);n.push(Object.assign({layer:s.Layer,start:s.Start,end:s.End,style:s.Style,name:s.Name,margin:{left:s.MarginL||o.MarginL,right:s.MarginR||o.MarginR,vertical:s.MarginV||o.MarginV},effect:s.Effect},l,{alignment:c}))}for(var f=0;f<n.length;f++){n[f].layer-=a}return n.sort(function(e,t){return e.start-t.start||e.end-t.end})}var DEFAULT_STYLE={Name:"Default",Fontname:"Arial",Fontsize:"20",PrimaryColour:"&H00FFFFFF&",SecondaryColour:"&H000000FF&",OutlineColour:"&H00000000&",BackColour:"&H00000000&",Bold:"0",Italic:"0",Underline:"0",StrikeOut:"0",ScaleX:"100",ScaleY:"100",Spacing:"0",Angle:"0",BorderStyle:"1",Outline:"2",Shadow:"2",Alignment:"2",MarginL:"10",MarginR:"10",MarginV:"10",Encoding:"1"};function parseStyleColor(e){if(/^(&|H|&H)[0-9a-f]{6,}/i.test(e)){var t=e.match(/&?H?([0-9a-f]{2})?([0-9a-f]{6})/i);var r=t[1];var a=t[2];return[r||"00",a]}var n=parseInt(e,10);if(!isNaN(n)){var i=-2147483648;var s=2147483647;if(n<i){return["00","000000"]}var o=i<=n&&n<=s?("00000000"+(n<0?n+4294967296:n).toString(16)).slice(-8):String(n).slice(0,8);return[o.slice(0,2),o.slice(2)]}return["00","000000"]}function compileStyles(e){var y=e.info;var t=e.style;var r=e.defaultStyle;var m={};var d=[Object.assign({},r,{Name:"Default"})].concat(t);var a=function(e){var t=Object.assign({},DEFAULT_STYLE,d[e]);if(/^(\*+)Default$/.test(t.Name)){t.Name="Default"}Object.keys(t).forEach(function(e){if(e!=="Name"&&e!=="Fontname"&&!/Colour/.test(e)){t[e]*=1}});var r=parseStyleColor(t.PrimaryColour);var a=r[0];var n=r[1];var i=parseStyleColor(t.SecondaryColour);var s=i[0];var o=i[1];var l=parseStyleColor(t.OutlineColour);var c=l[0];var f=l[1];var u=parseStyleColor(t.BackColour);var p=u[0];var v=u[1];var g={fn:t.Fontname,fs:t.Fontsize,c1:n,a1:a,c2:o,a2:s,c3:f,a3:c,c4:v,a4:p,b:Math.abs(t.Bold),i:Math.abs(t.Italic),u:Math.abs(t.Underline),s:Math.abs(t.StrikeOut),fscx:t.ScaleX,fscy:t.ScaleY,fsp:t.Spacing,frz:t.Angle,xbord:t.Outline,ybord:t.Outline,xshad:t.Shadow,yshad:t.Shadow,fe:t.Encoding,q:/^[0-3]$/.test(y.WrapStyle)?y.WrapStyle*1:2};m[t.Name]={style:t,tag:g}};for(var n=0;n<d.length;n++)a(n);return m}function compile(e,t){if(t===void 0)t={};var r=parse(e);var a=compileStyles({info:r.info,style:r.styles.style,defaultStyle:t.defaultStyle||{}});return{info:r.info,width:r.info.PlayResX*1||null,height:r.info.PlayResY*1||null,wrapStyle:/^[0-3]$/.test(r.info.WrapStyle)?r.info.WrapStyle*1:2,collisions:r.info.Collisions||"Normal",styles:a,dialogues:compileDialogues({styles:a,dialogues:r.events.dialogue})}}function decompileStyle(e){var t=e.style;var r=e.tag;var a=Object.assign({},t,{PrimaryColour:"&H"+r.a1+r.c1,SecondaryColour:"&H"+r.a2+r.c2,OutlineColour:"&H"+r.a3+r.c3,BackColour:"&H"+r.a4+r.c4});return"Style: "+stylesFormat.map(function(e){return a[e]}).join()}var drawingInstructionMap={M:"m",L:"l",C:"b"};function decompileDrawing(e){var t=e.instructions;return t.map(function(e){var t;var r=e.type;var a=e.points;return(t=[drawingInstructionMap[r]]).concat.apply(t,a.map(function(e){var t=e.x;var r=e.y;return[t,r]})).join(" ")}).join(" ")}var ca=function(r){return function(t){return function(e){return""+t+r+"&H"+e+"&"}}};var c=ca("c");var a=ca("a");var tagDecompiler={c1:c(1),c2:c(2),c3:c(3),c4:c(4),a1:a(1),a2:a(2),a3:a(3),a4:a(4),pos:function(e){return"pos("+[e.x,e.y]+")"},org:function(e){return"org("+[e.x,e.y]+")"},move:function(e){return"move("+[e.x1,e.y1,e.x2,e.y2,e.t1,e.t2]+")"},fade:function(e){return e.type==="fad"?"fad("+[e.t1,e.t2]+")":"fade("+[e.a1,e.a2,e.a3,e.t1,e.t2,e.t3,e.t4]+")"},clip:function(e){return(e.inverse?"i":"")+"clip("+(e.dots?""+[e.dots.x1,e.dots.y1,e.dots.x2,e.dots.y2]:""+(e.scale===1?"":e.scale+",")+decompileDrawing(e.drawing))+")"},t:function(e){return e.map(function(e){return"t("+[e.t1,e.t2,e.accel,decompileTag(e.tag)]+")"}).join("\\")}};function decompileTag(r){return Object.keys(r).map(function(t){var e=tagDecompiler[t]||function(e){return""+t+e};return"\\"+e(r[t])}).join("")}function decompileSlice(e){return e.fragments.map(function(e){var t=e.tag;var r=e.text;var a=e.drawing;var n=decompileTag(t);return""+(n?"{"+n+"}":"")+(a?decompileDrawing(a):r)}).join("")}function decompileText(n,i){return n.slices.filter(function(e){return e.fragments.length}).map(function(e,t){var r=JSON.parse(JSON.stringify(e));var a={};if(t){a.r=e.style===n.style?"":e.style}else{if(i.Alignment!==n.alignment){a.an=n.alignment}["pos","org","move","fade","clip"].forEach(function(e){if(n[e]){a[e]=n[e]}})}r.fragments[0].tag=Object.assign(a,r.fragments[0].tag);return r}).map(decompileSlice).join("")}function getMargin(e,t){return e===t?"0000":e}function decompileDialogue(e,t){return"Dialogue: "+[e.layer,stringifyTime(e.start),stringifyTime(e.end),e.style,e.name,getMargin(e.margin.left,t.MarginL),getMargin(e.margin.right,t.MarginR),getMargin(e.margin.vertical,t.MarginV),stringifyEffect(e.effect),decompileText(e,t)].join()}function decompile(e){var t=e.info;var r=e.width;var a=e.height;var n=e.collisions;var i=e.styles;var s=e.dialogues;return["[Script Info]",stringifyInfo(Object.assign({},t,{PlayResX:r,PlayResY:a,Collisions:n})),"","[V4+ Styles]","Format: "+stylesFormat.join(", ")].concat(Object.keys(i).map(function(e){return decompileStyle(i[e])}),[""],["[Events]"],["Format: "+eventsFormat.join(", ")],s.sort(function(e,t){return e.start-t.start||e.end-t.end}).map(function(e){return decompileDialogue(e,i[e.style].style)}),[""]).join("\n")}export{compile,decompile,parse,stringify};